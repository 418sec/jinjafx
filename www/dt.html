<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <title>DataTemplate</title>
    <link rel="shortcut icon" href="jinjafx.png">
    <style>
      .title { color: #0074D9; }
      .tags { color: #FF4136; }
    </style>
    <script>
      window.onload = function() {
        var dt = window.opener.dt;
        window.opener.reset_dt();

        if (Object.keys(dt).length !== 0) {
          dt.data = dt.data.match(/\S/) ? dt.data.trim() + "\n" : "";
          dt.template = dt.template.match(/\S/) ? dt.template.trim() + "\n" : "";
          dt.vars = dt.vars.match(/\S/) ? dt.vars.trim() + "\n" : "";

          var qs = [];
          for (var k in dt) {
            if (dt[k].length > 0) {
              qs.push(k + '=' + window.btoa(dt[k]));
            }
          }

          var url = window.location.origin + '/?' + qs.join('&');
          var dtx = "<span class=\"title\"># JinjaFx DataTemplate\n# https://github.com/cmason3/jinjafx</span>\n\n";
          dtx += "<span class=\"title\"># Data URL</span> <a href=\"" + url + "\">" + ((url.length > 96) ? url.slice(0, 96) + "..." : url) + "</a>\n\n";
          dtx += "<span class=\"tags\">&lt;data.csv&gt;</span>\n" + window.opener.quote(dt.data) + "<span class=\"tags\">&lt;/data.csv&gt;</span>\n\n";
          dtx += "<span class=\"tags\">&lt;template.j2&gt;</span>\n" + window.opener.quote(dt.template) + "<span class=\"tags\">&lt;/template.j2&gt;</span>\n\n";
          dtx += "<span class=\"tags\">&lt;vars.yml&gt;</span>\n" + window.opener.quote(dt.vars) + "<span class=\"tags\">&lt;/vars.yml&gt;</span>\n";
          document.body.innerHTML = "<pre>" + dtx + "</pre>";
        }
      };
    </script>
  </head>
</html>
